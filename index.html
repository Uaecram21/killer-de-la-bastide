<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu du Killer</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        input, button { padding: 10px; margin: 5px; font-size: 1rem; }
        #game, #join, #lobby, #mission { display: none; }
        .hidden { display: none; }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js"></script>
</head>
<body>

    <h1>ðŸ”ª Jeu du Killer</h1>

    <div id="home">
        <button onclick="createGame()">CrÃ©er une partie</button>
        <button onclick="showJoin()">Rejoindre une partie</button>
    </div>

    <div id="join">
        <h2>Rejoindre une partie</h2>
        <input id="joinCode" placeholder="Code de la partie">
        <input id="playerName" placeholder="Ton prÃ©nom">
        <button onclick="joinGame()">Rejoindre</button>
    </div>

    <div id="lobby">
        <h2>Code de la partie : <span id="gameCodeDisplay"></span></h2>
        <p>Joueurs inscrits :</p>
        <ul id="playerList"></ul>
        <button id="startBtn" onclick="startGame()">Lancer la partie</button>
    </div>

    <div id="mission">
        <h2>Ta mission ðŸŽ¯</h2>
        <p id="missionText"></p>
        <h3>Ta cible ðŸ‘¤</h3>
        <p id="targetText"></p>
    </div>

    <script>
       const firebaseConfig = {
  apiKey: "AIzaSyBAgpkTnrkML3IahRDwMb27lLZ0MwwnzgA",
  authDomain: "le-killer-de-la-bastide.firebaseapp.com",
  projectId: "le-killer-de-la-bastide",
  storageBucket: "le-killer-de-la-bastide.firebasestorage.app",
  messagingSenderId: "1007289482448",
  appId: "1:1007289482448:web:01814ae0e6f932d31df2d5"
};
        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const missions = [
            const missions = [
    "Faire boire un verre ðŸ¹",
    "Prendre un selfie ðŸ¤³",
    "Faire dire 'banane' ðŸŒ",
    "Donner un objet ðŸŽ",
    "Faire chanter ðŸŽ¶",
    "Faire s'asseoir ðŸª‘",
    "Faire raconter une blague ðŸ˜‚",
    "Prendre un stylo âœï¸",
    "Marcher 10 pas ðŸš¶",
    "Ã‰crire son prÃ©nom ðŸ–Šï¸",
    "Donner une poignÃ©e de main ðŸ¤",
    "Dire 'bonjour' en anglais ðŸ‡¬ðŸ‡§",
    "Toucher un mur ðŸ§±",
    "Regarder l'heure â°",
    "Dire son plat prÃ©fÃ©rÃ© ðŸ½ï¸",
    "Mettre les mains sur la tÃªte ðŸ™†",
    "Dire un chiffre au hasard ðŸ”¢",
    "Faire un clin d'Å“il ðŸ˜‰",
    "Taper dans la main de quelqu'un âœ‹",
    "Toucher un objet rouge ðŸ”´",
    "Dire le mot 'fromage' ðŸ§€",
    "Se lever puis se rasseoir ðŸª‘",
    "Donner un high five ðŸ™Œ",
    "Dire une couleur ðŸŽ¨",
    "Dire 'j'ai faim' ðŸ”",
    "Mimer un animal ðŸ’",
    "Faire un cÅ“ur avec les mains â¤ï¸",
    "Chuchoter quelque chose ðŸ¤«",
    "S'Ã©tirer ðŸ§˜",
    "Dire un prÃ©nom qui nâ€™est pas le sien ðŸ‘¤",
    "Toucher une porte ðŸšª",
    "Parler dâ€™un film ðŸŽ¬",
    "Mettre ses mains dans ses poches ðŸ‘–",
    "Demander lâ€™heure Ã  quelquâ€™un âŒš",
    "Imiter un accent ðŸŽ­",
    "Dire 'oui' deux fois d'affilÃ©e âœ…",
    "Taper du pied ðŸ‘£",
    "Regarder par la fenÃªtre ðŸªŸ",
    "Tirer la langue ðŸ‘…",
    "Dire 'câ€™est vrai' ðŸ™Š",
    "Mettre les bras croisÃ©s ðŸ™…",
    "Dire un pays ðŸŒ",
    "Dire 'coucou' ðŸ‘‹",
    "Toucher un livre ðŸ“š",
    "Montrer du doigt ðŸ“Œ",
    "Dire 'je sais pas' ðŸ¤·",
    "Dire le nom dâ€™un mois ðŸ“…",
    "Demander un stylo âœï¸",
    "Imiter une sirÃ¨ne ðŸš¨",
    "Souffler trÃ¨s fort ðŸ˜¤",
    "Parler dâ€™un sport ðŸ€",
    "Chanter une note ðŸŽµ",
    "Dire 'au revoir' ðŸ‘‹",
    "Faire semblant de tomber ðŸ¤¦",
    "Dire un animal ðŸ¶",
    "Faire un signe de la main ðŸ‘‹"
];

        ];

        let currentGameId = null;
        let currentPlayerId = null;

        function randomCode() {
            return Math.random().toString(36).substring(2, 6).toUpperCase();
        }

        function createGame() {
            const code = randomCode();
            db.collection("games").doc(code).set({ players: [], started: false });
            currentGameId = code;
            document.getElementById("gameCodeDisplay").innerText = code;
            document.getElementById("home").style.display = "none";
            document.getElementById("lobby").style.display = "block";
            listenPlayers();
        }

        function showJoin() {
            document.getElementById("home").style.display = "none";
            document.getElementById("join").style.display = "block";
        }

        function joinGame() {
            const code = document.getElementById("joinCode").value.toUpperCase();
            const name = document.getElementById("playerName").value.trim();
            if (!code || !name) return alert("Remplis tous les champs !");
            currentGameId = code;
            const playerRef = db.collection("games").doc(code).collection("players").doc();
            playerRef.set({ name: name, mission: "", target: "" });
            currentPlayerId = playerRef.id;
            db.collection("games").doc(code).onSnapshot(doc => {
                if (doc.data()?.started) {
                    db.collection("games").doc(code).collection("players").doc(currentPlayerId).get().then(playerDoc => {
                        const data = playerDoc.data();
                        document.getElementById("missionText").innerText = data.mission;
                        document.getElementById("targetText").innerText = data.target;
                        document.getElementById("join").style.display = "none";
                        document.getElementById("mission").style.display = "block";
                    });
                }
            });
            alert("Inscrit dans la partie !");
        }

        function listenPlayers() {
            db.collection("games").doc(currentGameId).collection("players").onSnapshot(snapshot => {
                const list = document.getElementById("playerList");
                list.innerHTML = "";
                snapshot.forEach(doc => {
                    const li = document.createElement("li");
                    li.textContent = doc.data().name;
                    list.appendChild(li);
                });
            });
        }

        function startGame() {
            db.collection("games").doc(currentGameId).collection("players").get().then(snapshot => {
                const players = [];
                snapshot.forEach(doc => players.push({ id: doc.id, name: doc.data().name }));

                // MÃ©langer la liste
                players.sort(() => Math.random() - 0.5);

                // Assigner cibles + missions
                players.forEach((player, i) => {
                    const target = players[(i + 1) % players.length].name;
                    const mission = missions[Math.floor(Math.random() * missions.length)];
                    db.collection("games").doc(currentGameId).collection("players").doc(player.id).update({
                        target: target,
                        mission: mission
                    });
                });

                // Marquer la partie comme commencÃ©e
                db.collection("games").doc(currentGameId).update({ started: true });
            });
        }
    </script>

</body>
</html>
